# Kura Explorer

A modern web interface for exploring and analyzing Kura checkpoint data.

## Overview

Kura Explorer provides an intuitive interface to visualize and analyze conversation clusters generated by the Kura clustering pipeline. It includes interactive visualizations, search capabilities, and detailed analytics.

## Features

- **Interactive Cluster Visualization**: 2D map view with UMAP coordinates and hierarchical tree navigation
- **Conversation Browser**: Full-text search and filtering with language and frustration filters
- **Cluster Analytics**: Size distribution, task diversity metrics, and frustration patterns
- **Real-time Updates**: Hot-reloading development environment for rapid iteration

## Quick Start

```bash
# Using Docker (recommended)
cd kura/explorer
cp .env.example .env  # Configure KURA_CHECKPOINT_DIR
docker-compose up

# Using the CLI
kura explore ./checkpoints --port 8001

# Manual setup
cd backend && uvicorn main:app --reload --port 8001
cd frontend && npm install && npm run dev
```

Access the application at:
- Frontend: http://localhost:5173
- API Docs: http://localhost:8001/docs

## Architecture

### Components

- **Backend** (`/backend`): FastAPI service with SQLModel ORM for data access
- **Frontend** (`/frontend`): React + TypeScript with Vite and shadcn/ui components
- **Database** (`/db`): SQLite database with models for conversations, clusters, and summaries
- **Debug Scripts** (`/backend/debug_scripts`): Tools for analyzing clustering quality

### Data Flow

1. Checkpoint files are loaded into SQLite database on startup
2. API endpoints expose filtered and paginated data
3. Frontend fetches data and renders interactive visualizations
4. Real-time search queries are processed server-side

## Development

### Prerequisites

- Python 3.11+
- Node.js 18+
- Docker (optional)

### Setup Development Environment

```bash
# Install backend dependencies
cd backend
uv sync  # or pip install -r requirements.txt

# Install frontend dependencies
cd frontend
npm install

# Run with hot-reloading
cd ../..
./dev.sh
```

### Testing

```bash
# Run backend tests
cd backend
uv run pytest

# Run integration tests
./run_integration_tests.sh

# Generate coverage report
uv run pytest --cov=. --cov-report=html
```

See `/backend/tests/README.md` for detailed testing documentation.

## Configuration

Environment variables (`.env` file):

```bash
KURA_CHECKPOINT_DIR=/path/to/checkpoints  # Required
VITE_API_URL=http://localhost:8001       # Frontend API URL
BACKEND_PORT=8001                        # Backend port
FRONTEND_PORT=5173                       # Frontend port
```

## Subdirectories

- `/backend` - FastAPI backend service (see [backend/README.md](./backend/README.md))
- `/frontend` - React frontend application (see [frontend/README.md](./frontend/README.md))
- `/db` - Database models and loaders (see [db/README.md](./db/README.md))

## Troubleshooting

### Common Issues

1. **"Explorer not initialized"**: Ensure `KURA_CHECKPOINT_DIR` points to valid checkpoint files
2. **Port conflicts**: Change ports in `.env` file
3. **Database errors**: Check that checkpoint files contain valid JSON/JSONL data

### Debug Tools

Use the debug scripts to analyze clustering quality:

```bash
cd backend
python debug_scripts/analyze_all_clusters.py
python debug_scripts/clustering_quality_report.py
```

## Production Deployment

For production, consider:

1. Using PostgreSQL instead of SQLite
2. Adding SSL/TLS termination
3. Setting up monitoring and logging
4. Using the production docker-compose configuration

See the Docker configuration section for production setup examples.
